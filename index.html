<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Toporak</title>
<style>
  * {box-sizing: border-box;}
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin:0; padding:0;
    background: linear-gradient(to bottom right, #141e30, #243b55);
    color: #f0f0f0;
  }
  header, footer {
    background:#111; padding:1.5rem; text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.5);
  }
  header h1 {
    margin:0; font-size:2.5rem; color:#00d4ff;
  }
  main {
    padding:3rem 2rem; max-width:900px; margin:auto; text-align:center;
  }
  section {margin-bottom:3rem;}
  h2,h3 {color:#00ffc8;}
  button {
    padding:1rem 2rem; margin:0.5rem;
    background:#0077cc; color:#fff;
    border:none; border-radius:10px;
    font-size:1.1rem; cursor:pointer;
    transition: all 0.3s ease;
  }
  button:hover {
    background:#005fa3; transform: scale(1.05);
  }
  input, select, textarea {
    padding:0.6rem; margin:0.5rem auto;
    border-radius:6px; border:1px solid #ccc;
    width: 80%; max-width:400px;
    display: block;
    font-size:1rem;
  }
  ul {list-style:none; padding:0;}
  ul li {margin:0.3rem;}
  a {
    color:#ffcc00; text-decoration:none;
  }
  a:hover {text-decoration:underline;}
  #series-page, #admin-panel, #game-detail-page {
    display:none;
  }
  #secret-admin-btn {
    position:absolute; bottom:2px; right:2px;
    background:transparent; border:none;
    color:transparent; width:10px; height:10px;
    cursor:pointer;
  }
  .game-entry {
    margin-top:1rem;
    display:flex; justify-content:center; align-items:center;
  }
  .game-entry button {
    margin-left:0.5rem;
  }
  .platform-links ul {
    display:flex; justify-content:center; gap:1rem;
    padding-left:0;
  }
  .platform-links ul li a {
    padding:0.3rem 0.7rem;
    background:#0077cc; border-radius:6px;
  }
  #json-download {
    background:#00bb00;
    margin-top:1rem;
  }
  textarea {
    resize: vertical;
    min-height: 100px;
  }
  label {
    font-weight: bold;
    margin-top: 1rem;
    display: block;
  }
</style>
</head>
<body>
<header>
  <h1>Toporak</h1>
</header>
<main>
  <section id="main-page">
    <h2>2025 yılında kurulan Toporak, yazılım ve teknoloji geliştirmeye odaklanmıştır.</h2>
    <h3>Oyun Serilerimiz</h3>
    <div id="series-buttons"></div>
  </section>

  <section id="series-page">
    <button onclick="backToMain()">← Ana Sayfa</button>
    <h2 id="series-title">Seri Oyunları</h2>
    <div id="series-buttons-container"></div>
    <div class="platform-links" id="platform-links"></div>
  </section>

  <section id="game-detail-page">
    <button onclick="backToSeries()">← Seriye Geri Dön</button>
    <h2 id="game-detail-title"></h2>
    <img id="game-image" src="" alt="" style="max-width:300px; margin:1rem auto; display:block; border-radius:12px;"/>
    <p id="game-description" style="max-width:600px; margin:auto;"></p>
    <div class="platform-links" id="game-platform-links"></div>
    <p><strong>İndirme Sayacı:</strong> <span id="download-count">0</span></p>
    <h3>Kullanıcı Yorumları</h3>
    <ul id="comments-list" style="max-width:600px; margin:auto; text-align:left;"></ul>
    <textarea id="comment-input" placeholder="Yorum yazınız..."></textarea>
    <button onclick="addComment()">Yorum Ekle</button>
  </section>

  <section id="admin-panel">
    <button onclick="closeAdmin()">× Kapat</button>
    <h2>Admin Paneli</h2>

    <h3>Yeni Seri Ekle</h3>
    <input type="text" id="new-series" placeholder="Yeni Seri Adı" />

    <h3>Yeni Oyun Ekle</h3>
    <select id="game-series-select">
      <option value="">Lütfen Seri Seçiniz</option>
    </select>
    <input type="text" id="game-name" placeholder="Oyun Adı" required />
    <input type="url" id="game-image-url" placeholder="Görsel URL'si" required />
    <textarea id="game-description-input" placeholder="Oyun Açıklaması (isteğe bağlı)"></textarea>
    <input type="url" id="android-link" placeholder="Android İndirme Linki" required />
    <input type="url" id="ios-link" placeholder="iOS İndirme Linki" required />
    <input type="url" id="windows-link" placeholder="Windows İndirme Linki" required />
    <input type="url" id="macos-link" placeholder="macOS İndirme Linki" required />

    <button onclick="addSeries()">Seri Ekle</button>
    <button onclick="addGame()">Oyun Ekle</button>

    <h3>Oyunlar</h3>
    <div id="admin-games-list" style="max-height:300px; overflow-y:auto;"></div>

    <h3>JSON Dosyasını İndir</h3>
    <button id="json-download" onclick="downloadJson()" style="display:none;">JSON İndir</button>
    <textarea id="json-output" readonly style="width:100%; max-height:300px; display:none;"></textarea>
  </section>
</main>

<footer>
  <small>&copy; 2025 Toporak</small>
  <button id="secret-admin-btn" onclick="promptAdminAccess()">Admin</button>
</footer>

<script>
  // Veri yapı ve değişkenler
  let data = {
    series: [], // ["RütbeX", "Diğer Seri"]
    games: [
      /* {
        name:"Örnek Oyun",
        series:"RütbeX",
        image:"",
        description:"",
        android:"",
        ios:"",
        windows:"",
        macos:"",
        downloadCount:0,
        comments:[]
      } */
    ]
  };

  let currentSeries = null;
  let currentGame = null;
  let isAdmin = false;

  // LocalStorage'dan yükle (yeni sistemde bunu kullanma, manuel JSON ile yapacağız)
  /*
  function loadData() {
    const raw = localStorage.getItem("toporakData");
    if(raw) data = JSON.parse(raw);
  }
  function saveData() {
    localStorage.setItem("toporakData", JSON.stringify(data));
  }
  */

  // GitHub'dan JSON çekmek için URL
  // Buraya GitHub raw linkini yazmalısın:
  const GITHUB_RAW_BASE = "https://raw.githubusercontent.com/username/repository/branch/";

  // Örnek: "RütbeX.json"
  function fetchData() {
    // Tüm serileri ayrı dosya olarak alacağız, ilk olarak "seriesList.json" dosyası olabilir.
    fetch(GITHUB_RAW_BASE + "seriesList.json")
      .then(res => res.json())
      .then(seriesList => {
        data.series = seriesList;
        updateSeriesButtons();
        // Seri ilk seçildiğinde o seriye ait oyunlar JSON olarak çekilecek
        // Örnek: "RutbeX_games.json"
      }).catch(e=>{
        alert("Veri çekme hatası! GitHub bağlantısını kontrol et.");
        console.error(e);
      });
  }

  // Seri butonları oluştur
  function updateSeriesButtons() {
    const container = document.getElementById("series-buttons");
    container.innerHTML = "";
    data.series.forEach(s=>{
      const btn = document.createElement("button");
      btn.textContent = s;
      btn.onclick = () => openSeriesPage(s);
      container.appendChild(btn);
    });
  }

  // Seri sayfası aç
  function openSeriesPage(series) {
    currentSeries = series;
    document.getElementById("main-page").style.display = "none";
    document.getElementById("series-page").style.display = "block";
    document.getElementById("series-title").textContent = series + " Oyunları";
    loadGamesForSeries(series);
  }

  // Seri oyunlarını GitHub'dan JSON olarak çek
  function loadGamesForSeries(series) {
    fetch(GITHUB_RAW_BASE + series + "_games.json")
      .then(res => res.json())
      .then(games => {
        data.games = games;
        updateSeriesGamesList();
      })
      .catch(e=>{
        data.games = [];
        updateSeriesGamesList();
      });
  }

  // Seri oyunlarını listele
  function updateSeriesGamesList() {
    const container = document.getElementById("series-buttons-container");
    container.innerHTML = "";
    data.games.forEach(game=>{
      if(game.series !== currentSeries) return;
      const div = document.createElement("div");
      div.className = "game-entry";

      const btn = document.createElement("button");
      btn.textContent = game.name;
      btn.onclick = () => openGameDetail(game);

      div.appendChild(btn);
      container.appendChild(div);
    });
  }

  // Ana sayfaya geri dön
  function backToMain() {
    currentSeries = null;
    currentGame = null;
    document.getElementById("series-page").style.display = "none";
    document.getElementById("main-page").style.display = "block";
    clearGameDetail();
  }

  // Oyunun detay sayfası aç
  function openGameDetail(game) {
    currentGame = game;
    incrementDownloadCount(game);
    document.getElementById("series-page").style.display = "none";
    document.getElementById("game-detail-page").style.display = "block";
    document.getElementById("game-detail-title").textContent = game.name;
    document.getElementById("game-image").src = game.image || "";
    document.getElementById("game-image").alt = game.name;
    document.getElementById("game-description").textContent = game.description || "Açıklama yok.";
    showPlatformLinks(game);
    updateDownloadCount(game);
    updateComments(game);
  }

  // Oyundan detay sayfasına geri dön
  function backToSeries() {
    currentGame = null;
    document.getElementById("game-detail-page").style.display = "none";
    document.getElementById("series-page").style.display = "block";
    clearCommentInput();
  }

  // Platform linklerini göster
  function showPlatformLinks(game) {
    const container = document.getElementById("game-platform-links");
    container.innerHTML = `
      <ul>
        <li><a href="${game.android}" target="_blank">Android</a></li>
        <li><a href="${game.ios}" target="_blank">iOS</a></li>
        <li><a href="${game.windows}" target="_blank">Windows</a></li>
        <li><a href="${game.macos}" target="_blank">macOS</a></li>
      </ul>
    `;
  }

  // İndirme sayacını artır (burada localStorage olarak geçici tutuyoruz)
  function incrementDownloadCount(game) {
    const key = "downloadCount_" + game.name.replace(/\s+/g, "_");
    let count = parseInt(localStorage.getItem(key) || "0");
    count++;
    localStorage.setItem(key, count);
    game.downloadCount = count;
  }
  function updateDownloadCount(game) {
    const key = "downloadCount_" + game.name.replace(/\s+/g, "_");
    let count = parseInt(localStorage.getItem(key) || "0");
    document.getElementById("download-count").textContent = count;
  }

  // Yorum ekle
  function addComment() {
    const commentInput = document.getElementById("comment-input");
    const commentText = commentInput.value.trim();
    if(!commentText) return alert("Lütfen yorum yazınız.");
    if(!currentGame) return alert("Oyun seçili değil.");

    if(!currentGame.comments) currentGame.comments = [];
    currentGame.comments.push(commentText);
    updateComments(currentGame);
    commentInput.value = "";
  }

  // Yorumları göster
  function updateComments(game) {
    const ul = document.getElementById("comments-list");
    ul.innerHTML = "";
    if(!game.comments || game.comments.length === 0){
      ul.innerHTML = "<li>Henüz yorum yok.</li>";
      return;
    }
    game.comments.forEach(c=>{
      const li = document.createElement("li");
      li.textContent = c;
      ul.appendChild(li);
    });
  }

  function clearCommentInput() {
    document.getElementById("comment-input").value = "";
  }

  // Admin işlemleri
  function promptAdminAccess() {
    const code = prompt("Admin kodunu giriniz:");
    if(code === "29042113" || code === "66698688"){
      isAdmin = true;
      document.getElementById("admin-panel").style.display = "block";
      populateSeriesSelect();
      refreshAdminGamesList();
      alert("Admin paneline hoş geldiniz.");
    } else {
      alert("Hatalı kod!");
    }
  }

  function closeAdmin(){
    isAdmin = false;
    document.getElementById("admin-panel").style.display = "none";
  }

  function addSeries(){
    const input = document.getElementById("new-series");
    const newS = input.value.trim();
    if(!newS) return alert("Seri adı boş olamaz.");
    if(data.series.includes(newS)) return alert("Bu seri zaten var.");
    data.series.push(newS);
    input.value = "";
    populateSeriesSelect();
    updateSeriesButtons();
  }

  function populateSeriesSelect(){
    const select = document.getElementById("game-series-select");
    select.innerHTML = '<option value="">Lütfen Seri Seçiniz</option>';
    data.series.forEach(s=>{
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      select.appendChild(opt);
    });
  }

  function addGame(){
    if(!isAdmin) return alert("Admin değilsiniz!");
    const name = document.getElementById("game-name").value.trim();
    const series = document.getElementById("game-series-select").value;
    const image = document.getElementById("game-image-url").value.trim();
    const description = document.getElementById("game-description-input").value.trim();
    const android = document.getElementById("android-link").value.trim();
    const ios = document.getElementById("ios-link").value.trim();
    const windows = document.getElementById("windows-link").value.trim();
    const macos = document.getElementById("macos-link").value.trim();

    if(!name || !series || !image || !android || !ios || !windows || !macos){
      return alert("Lütfen tüm zorunlu alanları doldurun.");
    }

    // Aynı isimde oyun varsa engelle
    if(data.games.some(g => g.name.toLowerCase() === name.toLowerCase())){
      return alert("Aynı isimde bir oyun zaten mevcut.");
    }

    const newGame = {
      name, series, image, description,
      android, ios, windows, macos,
      downloadCount: 0,
      comments: []
    };
    data.games.push(newGame);
    refreshAdminGamesList();
    clearGameForm();
    alert("Oyun eklendi. JSON oluşturup indirin!");
    showJsonDownloadButton();
  }

  function clearGameForm(){
    document.getElementById("game-name").value = "";
    document.getElementById("game-series-select").value = "";
    document.getElementById("game-image-url").value = "";
    document.getElementById("game-description-input").value = "";
    document.getElementById("android-link").value = "";
    document.getElementById("ios-link").value = "";
    document.getElementById("windows-link").value = "";
    document.getElementById("macos-link").value = "";
  }

  // Admin oyun listesi yenile
  function refreshAdminGamesList(){
    const container = document.getElementById("admin-games-list");
    container.innerHTML = "";
    if(data.games.length === 0){
      container.textContent = "Henüz oyun yok.";
      return;
    }
    data.games.forEach((game,i)=>{
      const div = document.createElement("div");
      div.style.display = "flex";
      div.style.justifyContent = "space-between";
      div.style.alignItems = "center";
      div.style.padding = "0.2rem 0";

      const span = document.createElement("span");
      span.textContent = `${game.name} (${game.series})`;
      div.appendChild(span);

      // Düzenle butonu
      const editBtn = document.createElement("button");
      editBtn.textContent = "Düzenle";
      editBtn.onclick = () => editGame(i);
      div.appendChild(editBtn);

      // Sil butonu
      const delBtn = document.createElement("button");
      delBtn.textContent = "Sil";
      delBtn.style.background = "#cc0033";
      delBtn.onclick = () => {
        if(confirm("Oyu silmek istediğinize emin misiniz?")){
          deleteGame(i);
        }
      };
      div.appendChild(delBtn);

      container.appendChild(div);
    });
  }

  // Oyun düzenleme fonksiyonu
  function editGame(index){
    if(!isAdmin) return alert("Admin değilsiniz!");
    const game = data.games[index];
    document.getElementById("game-name").value = game.name;
    document.getElementById("game-series-select").value = game.series;
    document.getElementById("game-image-url").value = game.image;
    document.getElementById("game-description-input").value = game.description;
    document.getElementById("android-link").value = game.android;
    document.getElementById("ios-link").value = game.ios;
    document.getElementById("windows-link").value = game.windows;
    document.getElementById("macos-link").value = game.macos;

    // Sil önceki kayıt
    data.games.splice(index,1);
    refreshAdminGamesList();
    alert("Değişikliklerinizi yaptıktan sonra 'Oyun Ekle'ye basınız.");
    showJsonDownloadButton();
  }

  // Oyun silme
  function deleteGame(index){
    if(!isAdmin) return alert("Admin değilsiniz!");
    data.games.splice(index,1);
    refreshAdminGamesList();
    alert("Oyun silindi.");
    showJsonDownloadButton();
  }

  // JSON metni oluştur ve indir
  function generateJsonText(){
    // Her seriye ait oyunları gruplamak için:
    let grouped = {};
    data.series.forEach(s=>{
      grouped[s] = data.games.filter(g=>g.series===s);
    });
    return JSON.stringify(grouped, null, 2);
  }

  function downloadJson(){
    const jsonText = generateJsonText();
    const blob = new Blob([jsonText], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "toporak_games.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function showJsonDownloadButton(){
    document.getElementById("json-download").style.display = "inline-block";
  }

  // Sayfa yüklenince ana sayfa ve admin seçimlerini hazırla
  window.onload = () => {
    // Şimdilik localStorage değil, GitHub'dan fetch mantığı eklenecek
    // Demo için sabit seri ve oyunlar koyabiliriz:
    if(data.series.length === 0){
      data.series = ["RütbeX", "Macera", "Strateji"];
    }
    if(data.games.length === 0){
      data.games.push({
        name:"Demo Oyun",
        series:"RütbeX",
        image:"https://via.placeholder.com/300x150?text=Demo+Oyun",
        description:"Bu bir demo oyun açıklamasıdır.",
        android:"#", ios:"#", windows:"#", macos:"#",
        downloadCount:0,
        comments:[]
      });
    }
    updateSeriesButtons();
  }
</script>

</body>
</html>
