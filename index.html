<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Toporak Oyun Sitesi</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(to bottom right, #141e30, #243b55);
      color: #f0f0f0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header, footer {
      background: #111;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    header h1 {
      margin: 0;
      font-size: 2.5rem;
      color: #00d4ff;
    }
    main {
      flex: 1;
      padding: 1rem 2rem 4rem;
      max-width: 900px;
      margin: auto;
      width: 100%;
    }
    section { margin-bottom: 2rem; }
    h2, h3 {
      color: #00ffc8;
      margin-bottom: 0.5rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      margin: 0.3rem;
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background: #005fa3;
      transform: scale(1.05);
    }
    input, select, textarea {
      padding: 0.6rem;
      margin: 0.5rem auto;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 80%;
      max-width: 400px;
      display: block;
      font-size: 1rem;
    }
    ul { list-style: none; padding: 0; }
    ul li { margin: 0.3rem 0; }
    a {
      color: #ffcc00;
      text-decoration: none;
      cursor: pointer;
    }
    a:hover {
      text-decoration: underline;
    }
    #series-buttons, #game-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    #series-buttons button, #game-list button {
      min-width: 90px;
      font-weight: bold;
    }
    #game-details {
      background: #222;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 0 10px #00d4ff88;
    }
    #game-details img {
      max-width: 180px;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #platform-links ul {
      padding-left: 1.2rem;
      margin-bottom: 1rem;
    }
    #comments {
      max-height: 200px;
      overflow-y: auto;
      background: #111;
      padding: 0.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .comment {
      border-bottom: 1px solid #333;
      padding: 0.4rem 0;
      font-size: 0.9rem;
    }
    #admin-panel {
      background: #111;
      border-radius: 12px;
      padding: 1rem;
      margin-top: 2rem;
      display: none;
    }
    #secret-admin-btn {
      position: fixed;
      bottom: 5px;
      right: 5px;
      width: 12px;
      height: 12px;
      background: transparent;
      border: none;
      color: transparent;
      cursor: pointer;
      z-index: 1000;
    }
    label {
      display: block;
      font-weight: bold;
      margin-top: 0.8rem;
      color: #00ffc8;
    }
  </style>
</head>
<body>

<header>
  <h1>Toporak Oyun Sitesi</h1>
</header>

<main>

  <section id="main-page">
    <h2>Oyun Serilerimiz</h2>
    <div id="series-buttons"></div>

    <h2>Oyunlar</h2>
    <div id="game-list"></div>
  </section>

  <section id="game-details" style="display:none;">
    <button onclick="closeGameDetails()" style="float:right; background:#cc0033;">Kapat</button>
    <h2 id="detail-name"></h2>
    <img id="detail-image" alt="Oyun Görseli" />
    <p><strong>Seri:</strong> <span id="detail-series"></span></p>
    <p><strong>Etiketler:</strong> <span id="detail-tags"></span></p>
    <div id="platform-links">
      <h3>İndir</h3>
      <ul>
        <li><a href="#" target="_blank" onclick="countDownload('android')">Android (<span id="count-android">0</span>)</a></li>
        <li><a href="#" target="_blank" onclick="countDownload('ios')">iOS (<span id="count-ios">0</span>)</a></li>
        <li><a href="#" target="_blank" onclick="countDownload('windows')">Windows (<span id="count-windows">0</span>)</a></li>
        <li><a href="#" target="_blank" onclick="countDownload('macos')">macOS (<span id="count-macos">0</span>)</a></li>
      </ul>
    </div>
    <div id="comments-section">
      <h3>Kullanıcı Yorumları</h3>
      <div id="comments"></div>
      <textarea id="new-comment" rows="3" placeholder="Yorumunu yaz..." ></textarea>
      <button onclick="addComment()">Yorum Ekle</button>
    </div>
  </section>

  <section id="admin-panel">
    <h2>Admin Paneli</h2>
    <h3>Seri Ekle</h3>
    <input type="text" id="new-series" placeholder="Yeni Seri Adı" />
    <button onclick="addSeries()">Seri Ekle</button>

    <h3>Oyun Ekle / Düzenle</h3>
    <form id="game-form" onsubmit="return saveGame(event)">
      <input type="hidden" id="edit-index" value="-1" />
      <label for="game-name">Oyun Adı (zorunlu)</label>
      <input type="text" id="game-name" required />

      <label for="game-series-select">Seri Seç (zorunlu)</label>
      <select id="game-series-select" required></select>

      <label for="game-tags">Etiketler (virgülle ayır)</label>
      <input type="text" id="game-tags" placeholder="Aksiyon, Macera, vs." />

      <label for="game-image">Görsel Yükle (PNG, JPG)</label>
      <input type="file" id="game-image" accept="image/png, image/jpeg" />

      <label for="android-link">Android Linki</label>
      <input type="url" id="android-link" placeholder="https://..." />

      <label for="ios-link">iOS Linki</label>
      <input type="url" id="ios-link" placeholder="https://..." />

      <label for="windows-link">Windows Linki</label>
      <input type="url" id="windows-link" placeholder="https://..." />

      <label for="macos-link">macOS Linki</label>
      <input type="url" id="macos-link" placeholder="https://..." />

      <button type="submit" id="save-btn">Ekle</button>
      <button type="button" onclick="cancelEdit()" style="background:#cc0033;">İptal</button>
    </form>
  </section>

</main>

<footer>
  <small>&copy; 2025 Toporak</small>
  <button id="secret-admin-btn" title="Admin Girişi" onclick="promptAdminAccess()"></button>
</footer>

<script>
  // Veri modelleri
  let seriesList = JSON.parse(localStorage.getItem('seriesList')) || [];
  let gamesList = JSON.parse(localStorage.getItem('gamesList')) || [];

  // Yorumlar oyun ismine göre
  let commentsData = JSON.parse(localStorage.getItem('commentsData')) || {};

  // Şu an detayda görünen oyun indeksi
  let currentGameIndex = null;

  // Admin durumu
  let isAdmin = false;

  // --- Sayfa yüklenirken ---
  window.onload = () => {
    refreshSeriesButtons();
    refreshGameList();
    refreshAdminSeriesSelect();
  };

  // Seri butonlarını güncelle
  function refreshSeriesButtons() {
    const container = document.getElementById('series-buttons');
    container.innerHTML = '';

    // Tüm seriler butonu
    const allBtn = document.createElement('button');
    allBtn.textContent = 'Tüm Seriler';
    allBtn.onclick = () => {
      refreshGameList();
    };
    container.appendChild(allBtn);

    seriesList.forEach(serie => {
      const btn = document.createElement('button');
      btn.textContent = serie;
      btn.onclick = () => refreshGameList(serie);
      container.appendChild(btn);
    });
  }

  // Oyun listesini güncelle (opsiyonel seri filtreli)
  function refreshGameList(filterSeries) {
    const container = document.getElementById('game-list');
    container.innerHTML = '';

    let filteredGames = filterSeries ? gamesList.filter(g => g.series === filterSeries) : gamesList;

    if(filteredGames.length === 0){
      container.innerHTML = '<p>Oyun bulunamadı.</p>';
      return;
    }

    filteredGames.forEach((game,i) => {
      const btn = document.createElement('button');
      btn.textContent = game.name;
      btn.onclick = () => showGameDetails(i);
      container.appendChild(btn);
    });
  }

  // Oyun detaylarını göster
  function showGameDetails(index) {
    currentGameIndex = index;
    const game = gamesList[index];
    if(!game) return;

    document.getElementById('main-page').style.display = 'none';
    document.getElementById('game-details').style.display = 'block';

    document.getElementById('detail-name').textContent = game.name;
    document.getElementById('detail-series').textContent = game.series;
    document.getElementById('detail-tags').textContent = game.tags ? game.tags.join(', ') : '-';

    if(game.image){
      document.getElementById('detail-image').src = game.image;
      document.getElementById('detail-image').style.display = 'block';
    } else {
      document.getElementById('detail-image').style.display = 'none';
    }

    // Platform linkleri ve sayaçları
    ['android','ios','windows','macos'].forEach(platform => {
      const countSpan = document.getElementById(`count-${platform}`);
      countSpan.textContent = game.downloadCount && game.downloadCount[platform] ? game.downloadCount[platform] : 0;
      const link = document.querySelector(`#platform-links a[href='${game[platform] || '#'}']`);
      if(link){
        link.href = game[platform];
        link.target = '_blank';
      }
    });

    // Yorumları göster
    renderComments();
  }

  // Detay sayfasını kapat
  function closeGameDetails() {
    currentGameIndex = null;
    document.getElementById('game-details').style.display = 'none';
    document.getElementById('main-page').style.display = 'block';
  }

  // İndirme sayacı arttır
  function countDownload(platform) {
    if(currentGameIndex === null) return;
    let game = gamesList[currentGameIndex];
    if(!game.downloadCount) game.downloadCount = {};
    if(!game.downloadCount[platform]) game.downloadCount[platform] = 0;
    game.downloadCount[platform]++;
    saveGamesList();
    // Güncel sayaç güncelle
    document.getElementById(`count-${platform}`).textContent = game.downloadCount[platform];
  }

  // Yorumları renderla
  function renderComments() {
    if(currentGameIndex === null) return;
    const game = gamesList[currentGameIndex];
    const commentBox = document.getElementById('comments');
    commentBox.innerHTML = '';
    const gameComments = commentsData[game.name] || [];
    if(gameComments.length === 0){
      commentBox.innerHTML = '<p>Henüz yorum yok.</p>';
      return;
    }
    gameComments.forEach(c => {
      const div = document.createElement('div');
      div.className = 'comment';
      div.textContent = c;
      commentBox.appendChild(div);
    });
  }

  // Yeni yorum ekle
  function addComment() {
    if(currentGameIndex === null) return alert('Lütfen önce bir oyun seçin.');
    const textarea = document.getElementById('new-comment');
    const val = textarea.value.trim();
    if(!val) return alert('Boş yorum eklenemez.');
    const game = gamesList[currentGameIndex];
    if(!commentsData[game.name]) commentsData[game.name] = [];
    commentsData[game.name].push(val);
    localStorage.setItem('commentsData', JSON.stringify(commentsData));
    textarea.value = '';
    renderComments();
  }

  // --- Admin işlemleri ---

  // Admin erişim isteği
  function promptAdminAccess() {
    if(isAdmin){
      isAdmin = false;
      document.getElementById('admin-panel').style.display = 'none';
      alert('Admin çıkışı yapıldı.');
      return;
    }
    const code = prompt('Admin kodunu gir:');
    if(code === '29042113' || code === '66698688'){
      isAdmin = true;
      document.getElementById('admin-panel').style.display = 'block';
      refreshAdminSeriesSelect();
      alert('Admin girişi başarılı.');
    } else {
      alert('Hatalı kod!');
    }
  }

  // Seri ekle
  function addSeries() {
    const newSeries = document.getElementById('new-series').value.trim();
    if(!newSeries) return alert('Lütfen seri adı girin.');
    if(seriesList.includes(newSeries)) return alert('Bu seri zaten var.');
    seriesList.push(newSeries);
    seriesList.sort();
    saveSeriesList();
    document.getElementById('new-series').value = '';
    refreshSeriesButtons();
    refreshAdminSeriesSelect();
  }

  // Admin için seri seçim kutusunu güncelle
  function refreshAdminSeriesSelect() {
    const select = document.getElementById('game-series-select');
    select.innerHTML = '';
    if(seriesList.length === 0){
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = 'Önce seri ekleyin';
      select.appendChild(opt);
      return;
    }
    const defaultOpt = document.createElement('option');
    defaultOpt.value = '';
    defaultOpt.textContent = 'Seri seçin';
    select.appendChild(defaultOpt);
    seriesList.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = s;
      select.appendChild(opt);
    });
  }

  // Oyun ekle / düzenle formunu kaydet
  function saveGame(event) {
    event.preventDefault();
    if(!isAdmin) return alert('Admin değilsiniz!');

    const editIndex = parseInt(document.getElementById('edit-index').value, 10);
    const name = document.getElementById('game-name').value.trim();
    const series = document.getElementById('game-series-select').value;
    const tagsRaw = document.getElementById('game-tags').value.trim();
    const tags = tagsRaw ? tagsRaw.split(',').map(t => t.trim()).filter(t => t) : [];
    const android = document.getElementById('android-link').value.trim();
    const ios = document.getElementById('ios-link').value.trim();
    const windows = document.getElementById('windows-link').value.trim();
    const macos = document.getElementById('macos-link').value.trim();

    if(!name || !series){
      return alert('Oyun adı ve seri seçimi zorunlu.');
    }

    // Görseli base64 olarak al
    const fileInput = document.getElementById('game-image');
    if(fileInput.files.length > 0){
      const reader = new FileReader();
      reader.onload = function(e){
        const base64img = e.target.result;
        saveGameToList(editIndex, name, series, tags, base64img, android, ios, windows, macos);
      };
      reader.readAsDataURL(fileInput.files[0]);
    } else {
      // Görsel seçilmemiş ise eski görsel kalabilir düzenlemede
      let existingImg = null;
      if(editIndex >= 0 && gamesList[editIndex]) existingImg = gamesList[editIndex].image || null;
      saveGameToList(editIndex, name, series, tags, existingImg, android, ios, windows, macos);
    }
    return false;
  }

  // Oyun kaydetme işlemi (listeye ekleme veya güncelleme)
  function saveGameToList(editIndex, name, series, tags, image, android, ios, windows, macos){
    if(editIndex >= 0){
      // Düzenleme
      gamesList[editIndex] = {
        ...gamesList[editIndex],
        name, series, tags, image, android, ios, windows, macos
      };
      alert('Oyun güncellendi.');
    } else {
      // Yeni oyun ekleme
      gamesList.push({
        name, series, tags, image, android, ios, windows, macos, downloadCount: {}
      });
      alert('Oyun eklendi.');
    }
    saveGamesList();
    refreshGameList();
    refreshAdminSeriesSelect();
    clearGameForm();
  }

  // Oyunları kaydet localStorage'a
  function saveGamesList() {
    localStorage.setItem('gamesList', JSON.stringify(gamesList));
  }

  // Serileri kaydet localStorage'a
  function saveSeriesList() {
    localStorage.setItem('seriesList', JSON.stringify(seriesList));
  }

  // Formu temizle
  function clearGameForm() {
    document.getElementById('edit-index').value = '-1';
    document.getElementById('game-name').value = '';
    document.getElementById('game-series-select').value = '';
    document.getElementById('game-tags').value = '';
    document.getElementById('game-image').value = '';
    document.getElementById('android-link').value = '';
    document.getElementById('ios-link').value = '';
    document.getElementById('windows-link').value = '';
    document.getElementById('macos-link').value = '';
    document.getElementById('save-btn').textContent = 'Ekle';
  }

  // Düzenleme için formu doldur
  function editGame(index) {
    if(!isAdmin) return alert('Admin değilsiniz!');
    const game = gamesList[index];
    if(!game) return;
    document.getElementById('edit-index').value = index;
    document.getElementById('game-name').value = game.name;
    document.getElementById('game-series-select').value = game.series;
    document.getElementById('game-tags').value = game.tags ? game.tags.join(', ') : '';
    document.getElementById('game-image').value = '';
    document.getElementById('android-link').value = game.android || '';
    document.getElementById('ios-link').value = game.ios || '';
    document.getElementById('windows-link').value = game.windows || '';
    document.getElementById('macos-link').value = game.macos || '';
    document.getElementById('save-btn').textContent = 'Güncelle';
    scrollTo(0,document.body.scrollHeight);
  }

  // Düzenlemeyi iptal et
  function cancelEdit() {
    clearGameForm();
  }

  // Oyun silme
  function deleteGame(index) {
    if(!isAdmin) return alert('Admin değilsiniz!');
    if(!confirm('Bu oyunu silmek istediğinize emin misiniz?')) return;
    gamesList.splice(index,1);
    saveGamesList();
    refreshGameList();
  }

  // --- UI güncellemeleri ---

  // Seri butonları güncelle (admin panel ve ana liste için)
  function refreshUI() {
    refreshSeriesButtons();
    refreshGameList();
    refreshAdminSeriesSelect();
  }

  // Yeni oyun listesinde, sil ve düzenle butonları da göster (admin için)
  function refreshGameList(filterSeries) {
    const container = document.getElementById('game-list');
    container.innerHTML = '';

    let filteredGames = filterSeries ? gamesList.filter(g => g.series === filterSeries) : gamesList;

    if(filteredGames.length === 0){
      container.innerHTML = '<p>Oyun bulunamadı.</p>';
      return;
    }

    filteredGames.forEach((game,i) => {
      const btn = document.createElement('button');
      btn.textContent = game.name;
      btn.onclick = () => showGameDetails(i);
      container.appendChild(btn);

      if(isAdmin){
        // Düzenle butonu
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Düzenle';
        editBtn.style.background = '#ffaa00';
        editBtn.style.color = '#000';
        editBtn.onclick = (e) => {
          e.stopPropagation();
          editGame(i);
        };
        container.appendChild(editBtn);

        // Sil butonu
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Sil';
        delBtn.style.background = '#cc0033';
        delBtn.onclick = (e) => {
          e.stopPropagation();
          deleteGame(i);
        };
        container.appendChild(delBtn);
      }
    });
  }

  // Sayfa yüklendiğinde UI güncelle
  window.onload = () => {
    refreshUI();
  };
</script>

</body>
</html>
